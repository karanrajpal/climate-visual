<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */
 
body { font: 12px Arial;}
 
path {
  fill: none;
}
 
.axis path,
.axis line {
	fill: none;
	stroke: grey;
	stroke-width: 1;
	shape-rendering: crispEdges;
}
.y.axis path{
	display: none; 
}
.axis .minor line {
  stroke: #777;
  stroke-dasharray: 2,2;
}
 
</style>
<body>
 
<!-- load the d3.js library -->	
<script src="http://d3js.org/d3.v3.min.js"></script>
 
<script>
var SECTION_1_SHOWING = false;
var	lineSvg;

function setupLine(year) {
	var gy;
	var	margins = {top: 30, right: 100, bottom: 100, left: 80},
		width = 800 - margins.left - margins.right,
		height = 400 - margins.top - margins.bottom;

	var sector = ["Electricity", "Manufacturing","Transportation", "Other Fuel Combustion","Fugitive Emissions", "Industrial Processes", "Agriculture", "Waste", "Land-Use Change and Forestry", "Bunker Fuels"]

	var id = [1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012]

	var	x = d3.scale.linear().range([0, width]);
	var	y = d3.scale.linear().range([height, 0]);
	 
	// Define the axes
	var	xAxis = d3.svg.axis().scale(x)
		.orient("bottom").ticks(10).tickFormat(function(d,i){
            return sector[i];
        });
	 
	var	yAxis = d3.svg.axis().scale(y)
		.orient("left").ticks(6)
		.tickSize(width)
		.outerTickSize(0)
    	.orient("right");
	 
	// Define the line
	var	valueline = d3.svg.line()
		.x(function(d) { return x(d.sector); })
		.y(function(d) { return y(d.amount); });

	lineSvg = d3.select("body")
	.append("svg")
		.attr("width", width + margins.left + margins.right)
		.attr("height", height + margins.top + margins.bottom)
	.append("g")
		.attr("transform", "translate(" + margins.left + "," + margins.top + ")");

		// Get the data
	d3.csv("line_data.csv", function(error, data) {
	  	if(error){
			console.log( error ) ;
		}

		data.forEach(function(d) {
			d.year = +d.year;
			d.sector = +d.sector;
			d.amount = +d.amount;
			
		});
	 
		// Scale the range of the data
		x.domain([d3.min(data, function(d) { return d.sector; }), d3.max(data, function(d) { return d.sector; })]);
		y.domain([0, d3.max(data, function(d) { return d.amount; })]);

		var dataNest = d3.nest()
        .key(function(d) {return d.year;})
        .entries(data);
	 
		var count = -1;
		dataNest.forEach(function(d) {
			count++;
	        lineSvg.append("path")
	        	.attr("class","line2")
	            .attr("id", id[count])
	            .attr("d", valueline(d.values))
	            .attr("opacity", 0)
	            .attr("stroke", "grey")

	            .on("mouseover", function () {
					var lineId = d3.select(this).attr("id");

					if(lineId<year){
						d3.select(this)
						.attr("stroke-width", 2)
						.attr("opacity", 1)
						.attr("stroke", "#90AFC5");
					}
				})
				.on("mouseout", function () {
					var lineId = d3.select(this).attr("id");

					if(lineId<year){
						d3.select(this)
						.attr("opacity", 0.3)
						.attr("stroke", "grey")
						.attr("stroke-width", 1);
					}
				});
		});

		for(var i=1990;i<year+1;i++){
			document.getElementById(i).setAttribute("opacity","0.3");
			document.getElementById(i).setAttribute("stroke-width",1);
		}

		document.getElementById(year).setAttribute("stroke","#336B87");
		document.getElementById(year).setAttribute("opacity","1");
		document.getElementById(year).setAttribute("stroke-width",2);
	 
		// Add the X Axis
		lineSvg.append("g")		
			.attr("class", "x axis")
			.attr("transform", "translate(0," + height + ")")
			.call(xAxis)
			.selectAll("text")
		  	.attr("y", 9)
		  	.attr("x", 9)
		  	.attr("dy", ".35em")
		  	.attr("transform", "rotate(30)")
		  	.style("text-anchor", "start");	
	 
		// Add the Y Axis
		gy = lineSvg.append("g")		
			.attr("class", "y axis")
			.call(yAxis);

		gy.selectAll("g").filter(function(d) { return d; })
		    .classed("minor", true);

		gy.selectAll("text")
		    .attr("x", -40)
		    .attr("dy", -4);
	});
}
 

function line(year){
	// Adds the svg canvas
	if(SECTION_1_SHOWING == false) {
		setupLine(year);
	}
	else{
		lineSvg.selectAll("line2")
		.attr("opacity","0");

		for(var i=1990;i<year+1;i++){
			var elm = document.getElementById(i);
    		elm.setAttribute("opacity","0.3");
    		elm.setAttribute("stroke","grey");
    		elm.setAttribute("stroke-width",1);
    	}
    	elm2 = document.getElementById(year);
    	elm2.setAttribute("stroke","#336B87");
    	elm2.setAttribute("opacity","1");
    	elm2.setAttribute("stroke-width",2);
	}
}

line(2012);

 
</script>
</body>