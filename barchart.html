
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: A bar chart whose data updates with new data (labels, too)</title>
				<script src="./d3/d3.min.js" charset="utf-8"></script>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>  
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>
		<p id= "China"> china </p>
		<p id= "USA"> usa </p>
		<p id= "UK"> uk </p>
		<div>什么都没有</div>
		<script>

			//Width and height
			var w = 600;
			var h = 250;

			d3.csv("sector.csv", function(error, data) {
	  			if(error){
					console.log( error ) ;
				}

				var datayear= d3.nest()
				    .key(function(d) { return d.year; })
				    .entries(data);                      

			var	dataset = datayear[0].values;

			for(i=0;i<dataset.length;i++){
				 	if(dataset[i].country == "China"){

				 		var a = Object.keys(dataset[i]);
						var data1=[];
						a.forEach(function(b) {
							data1.push(dataset[i][b])
							//data1= data1.slice(2, 12);
						})
						data1= data1.slice(2, 12);
				 	}
			}
			console.log(data1);

			var xScale = d3.scale.ordinal()
							.domain(d3.range(data1.length))
							.rangeRoundBands([0, w], 0.05);

			var yScale = d3.scale.linear()
							.domain([0, d3.max(data1)])
							.range([0, h]);
			
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			console.log(data1);

			//Create bars
			svg.selectAll("rect")
			   .data(data1)
			   .enter()
			   .append("rect")
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return h;
			   })
			   .attr("fill", "#D09683")
			   .transition()
		   	   .duration(500)
		   	   .ease("bounce")
		   	   .delay(function(d,i){
			   	   	if(i<4) {
			   	   		return 40
			   	   	}
			   	   	if(i>6){
			   	   		return 200
			   	   	}
					else return 100;
				})

			   .attr("y", function(d) {
			   		return h - yScale(d);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return yScale(d);
			   });

			//On click, update with new data			
			d3.select("#China")
				.on("click", function() {

					//New values for dataset
					for(i=0;i<dataset.length;i++){
				 	if(dataset[i].country == "USA"){

				 		var a = Object.keys(dataset[i]);
						var data2=[];
						a.forEach(function(b) {
							data2.push(dataset[i][b]);
						})
						data2= data2.slice(2, 12);
				 	}
			}

					//Update all rects
					svg.selectAll("rect")
					   .data(data2)

					   .attr("fill", "#FFD64D")
					   .transition()
				   	   .duration(500)
				   	   .ease("bounce")
				   	   .delay(function(d,i){
					   	   	if(i<4) {
					   	   		return 40
					   	   	}
					   	   	if(i>6){
					   	   		return 200
					   	   	}
							else return 100;
					   })
		   	   		   .attr("y", function(d) {
					   		return h - yScale(d);
					   })
					   .attr("height", function(d) {
					   		return yScale(d);
					   });
					   				
				});

			d3.select("#USA")
				.on("click", function() {

					//New values for dataset
					for(i=0;i<dataset.length;i++){
				 	if(dataset[i].country == "UK"){

				 		var a = Object.keys(dataset[i]);
						var data3=[];
						a.forEach(function(b) {
							data3.push(dataset[i][b]);
						})
						data3= data3.slice(2, 12);
				 	}
			}

					//Update all rects
					svg.selectAll("rect")
					   .data(data3)

					   .attr("fill", "#FA6775")
					   .transition()
				   	   .duration(500)
				   	   .ease("bounce")
				   	   .delay(function(d,i){
					   	   	if(i<4) {
					   	   		return 40
					   	   	}
					   	   	if(i>6){
					   	   		return 200
					   	   	}
							else return 100;
					   })
		   	   		   .attr("y", function(d) {
					   		return h - yScale(d);
					   })
					   .attr("height", function(d) {
					   		return yScale(d);
					   });
					   				
				});

				d3.select("#UK").on("click", function() {

					//New values for dataset
					for(i=0;i<dataset.length;i++){
				 	if(dataset[i].country == "China"){

				 		var a = Object.keys(dataset[i]);
						var data4=[];
						a.forEach(function(b) {
							data4.push(dataset[i][b]);
						})
						data4= data4.slice(2, 12);
				 	}
			}

					//Update all rects
					svg.selectAll("rect")
					   .data(data4)

					   .attr("fill", "#9bc01c")
					   .transition()
				   	   .duration(500)
				   	   .ease("bounce")
				   	   .delay(function(d,i){
					   	   	if(i<4) {
					   	   		return 40
					   	   	}
					   	   	if(i>6){
					   	   		return 200
					   	   	}
							else return 100;
						})
				   	   	.attr("y", function(d) {
							return h - yScale(d);
			 			})
			 			.attr("height", function(d) {
			 				return yScale(d);
			 			});					   				
				});
				});
		</script>
	</body>
</html>